// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL")
}

model Game {
  roomID       String     @id @unique @db.VarChar(6)
  inviteLink   String
  gameLink     String
  state        GameState  @default(value: CREATED)
  board        Board      @relation(fields: [boardId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  challenger   Challenger @relation(fields: [challengerId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  opponent     Opponent   @relation(fields: [opponentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  score        Score      @relation(fields: [scoreId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  boardId      Int
  challengerId Int
  opponentId   Int
  scoreId      Int
  createdAt    DateTime   @default(now())
}

model Score {
  id    Int    @id @default(autoincrement())
  X     Int    @default(0)
  O     Int    @default(0)
  Games Game[]
}

model Board {
  id    Int      @id @default(autoincrement())
  cells String[] @default(value: ["", "", "", "", "", "", "", "", ""])
  Games Game[]
}

model Challenger {
  id    Int    @id @default(autoincrement())
  name  String @db.VarChar(15)
  Games Game[]
}

model Opponent {
  id    Int    @id @default(autoincrement())
  name  String @db.VarChar(15)
  Games Game[]
}

enum GameState {
  CREATED
  OPPONENT_JOINING
  OPPONENT_JOINED
  IN_PROGRESS
  O_WON
  X_WON
  DRAW
}
